<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Document</title>
</head>
<body>


    <div class="jumbotron">
        <h1>AJAX: Asynchronous JavaScript And XML</h1>
        <h5>About AJAX</h5>
        <ul>
            <li>NOT a programming language! It is a series of interactions between<br>
                JavaScript, the HTML DOM, and the XMLHttpRequest
                object from the browser
            </li>
            <li>It is "asynchronous" because AJAX can exchange information with a <br>
                server "behind the scenes" -- meaning, there is no need to reload <br>
                the page in order to display the content received from the response
            </li>
            <li>Requests will not have to wait for a response from a prior request<br>
                in order to be sent
            </li>
        </ul>
        <h5>About the XMLHttpRequest object</h5>
        <ul>
            <li>Supported by most modern browsers *cough* dont use IE *cough*</li>
            <li>Used to exchange data with a server</li>
            <li>
                <code>
                    var xhr = new XMLHttpRequest();
                </code>
                </li>
                <li>
                    The object has various methods and properties</li>
                <li>
                <b>Important Methods</b>
                <ul>
                    <li>
                        <code>new XMLHttpRequest()</code> --> creates new object
                    </li>
                    <li>
                        <code>abort()</code> --> cancels the current request
                    </li>
                    <li>
                            <code>getAllResponseHeaders()</code> &
                            <code>getResponseHeader()</code> --> get response metadata
                    </li>
                    <li>
                        <code>open(method, url, async, username, pwd)</code> -> specify request;
                        <ul>
                            <li>method = HTTP verb</li>
                            <li>URL = location to send request</li>
                            <li>async = whether to execute request asynchronously or not; usually true</li>
                            <li>username and password = optional server credentials</li>
                        </ul>                        </li>
                    <li><code>send(content)</code> -> send the request. content = request body; optional</li>
                    <li><code>setRequestHeader()</code>--> set name/value pair in request header</li>
                </ul>
            </li>
            <li>
                <b>Important Properties:</b>
                <ul>                        <li>onreadystatechange - defines a function to be executed when the ready state property changes</li>
                    <li>readyState - holds the XHR status
                        <ul>
                            <li>0 - request not initialized </li>
                            <li>1 - server connection established</li>
                            <li>2 - request received</li>                                <li>3 - server is processing request</li>
                            <li>4 - response is ready</li>
                        </ul>
                    </li>
                        <li>responseText - response body as string</li>
                        <li>responseXML - response body as XML</li>
                        <li>status - HTTP response code (200)</li>
                        <li>statusText - HTTP response text (OK) </li>
                    </ul>
                </li>
            </ul>
            <h5>AJAX Workflow</h5>
            <ol>
                <li>create XMLHttpRequest object</li>
                <li>define onreadystatechange function</li>
                <li>open request</li>
                <li>send request</li>
            </ol>
            <li> If we have more than one AJAX task on a page, define one function for executing XHR and one function to handle 
                each of the tasks and pass to the xhr function as a callback
        </li>
    </div>
    
        <hr>
        <h4>Leverage AJAX to Use the Force</h4>
        <input type="number" id="swID" class="form-control col-4">
        <h5>Welcome to the force <span id="output"></span></h6>
        <button id="go" class="btn btn-primary">Go!</button>
    </div>
    <script
        src="https://code.jquery.com/jquery-3.3.1.js"
        integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
        crossorigin="anonymous">
    </script>
    <script>
        window.onload = function () {
            $('#go').on('click', getSW);
        }

        function getSW(){
            var id = $('#swID').val();
            var url = `https://swapi.co/api/people/${id}/`;
            //ajax
            //step 1 create xhr
            var xhr = new XMLHttpRequest();

            //step 2 define onreadstatechange functionality 
            xhr.onreadystatechange = function (){
                console.log(xhr.readyState);
                if (xhr.readyState == 4 && xhr.status == 200){
                    //console.log('successfully got: ' + xhr.responseText);
                    let jedi = JSON.parse(xhr.responseText);
                    $('#output').html(jedi.name);
                }
            };

            //step 3 open
            xhr.open('GET', url);

            xhr.send();

            console.log('Sent request and got: ' + xhr.responseText);

        } 
    </script>
</body>
</html>